const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:4000';
async function http(path, opts = {}) { const res = await fetch(API_URL + path, { headers: { 'Content-Type': 'application/json' }, ...opts }); if (!res.ok) { let body; try { body = await res.json(); } catch { body = { error: await res.text() } } throw new Error(body.error || res.statusText); } if (res.status === 204) return null; return res.json(); }
export const api = { getPatients: () => http('/api/patients'), createPatient: (patient) => http('/api/patients', { method: 'POST', body: JSON.stringify(patient) }), updatePatient: (caso, patient, userId) => http(`/api/patients/${caso}`, { method: 'PUT', body: JSON.stringify({ ...patient, userId }) }), deletePatient: (caso) => http(`/api/patients/${caso}`, { method: 'DELETE' }), lock: (caso, user) => http(`/api/lock/${caso}`, { method: 'POST', body: JSON.stringify({ userId: user.id, username: user.username }) }), unlock: (caso, user) => http(`/api/lock/${caso}`, { method: 'DELETE', body: JSON.stringify({ userId: user.id }) }), heartbeat: (caso, user) => http(`/api/lock/${caso}/heartbeat`, { method: 'POST', body: JSON.stringify({ userId: user.id }) }), };
export default API_URL;
